webpackJsonp([7],{"0iPh":function(t,e){t.exports=jQuery},"0xDb":function(t,e,i){"use strict";var n=i("Zrlr"),s=i.n(n),a=i("wxAW"),r=i.n(a),o=/[xy]/g,h=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(o,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16).slice(0,8)})},c=function(){function t(e,i,n,a){s()(this,t),this.x=n/2,this.y=a/2,this.width=100,this.height=100,this.rotation=0,this.id=h(),this.type=e,this.content=i}return r()(t,[{key:"setRect",value:function(t){return this.x=t.x,this.y=t.y,this.width=t.w,this.height=t.h,this.rotation=t.angle,{x:this.x,y:this.y,w:this.width,h:this.height,angle:this.rotation}}},{key:"toJSON",value:function(){return{x:this.x,y:this.y,width:this.width,height:this.height,rotation:this.rotation,id:this.id,type:this.type,content:this.content}}},{key:"fromJSON",value:function(t){for(var e in t){this[e]=t[e]}}}]),t}(),u=function(){function t(){s()(this,t),this.layers=[],this.activeId=null,this.width=0,this.height=0,this.backgroundUrl=""}return r()(t,[{key:"initCanvasSize",value:function(t,e){this.width=t,this.height=e}},{key:"addLayer",value:function(t,e){var i=new c(t,e,this.width,this.height);return this.layers.push(i),i}},{key:"activateLayer",value:function(t){this.activeId=t}},{key:"removeLayer",value:function(){var t=this.layers.findIndex(function(t){return t.id===this.activeId})[0];this.layers.splice(t,1),this.activeId=null}},{key:"findLayer",value:function(t){var e=this.layers.filter(function(e){return e.id===t});return 1===e.length?e[0]:null}},{key:"setLayerPosition",value:function(t,e){var i=this.findLayer(t);i&&i.setRect(e)}},{key:"setBackgroundUrl",value:function(t){this.backgroundUrl=t}},{key:"setSize",value:function(t,e){this.width=t,this.height=e}},{key:"toJSON",value:function(){return{layers:this.layers.map(function(t){return t.toJSON()}),width:this.width,height:this.height,backgroundUrl:this.backgroundUrl}}},{key:"fromJSON",value:function(t){var e=this,i=t.width,n=t.height,s=t.layers,a=t.backgroundUrl;0===this.width&&0===this.height&&(this.width=i,this.height=n),this.backgroundUrl=a,e.layers=[],s.forEach(function(t){e.addLayer(new c("text","",e.width,e.height)).fromJSON(t)})}}]),t}();i.d(e,"a",function(){return u}),i.d(e,"b",function(){return c})},"7QVd":function(t,e){},"BrM/":function(t,e){},NHnr:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={};i.d(n,"initCanvas",function(){return p}),i.d(n,"handleLayerChange",function(){return x});var s={};i.d(s,"canvasData",function(){return b}),i.d(s,"testData",function(){return w});var a=i("lRwf"),r=i.n(a),o={name:"App",data:function(){return{}},components:{Canvas:i("NYMm").default},computed:{},methods:{}},h={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("router-view")],1)},staticRenderFns:[]};var c=i("VU/8")(o,h,!1,function(t){i("Zmby")},"data-v-5df275ef",null).exports,u=i("pRNm"),d=i.n(u);r.a.use(d.a);var l,m=new d.a({routes:[{path:"/",name:"Home",component:function(){return Promise.all([i.e(0),i.e(3)]).then(i.bind(null,"LqM4"))}},{path:"/design",name:"Design",component:function(){return i.e(5).then(i.bind(null,"q2Ig"))}},{path:"/theme",name:"theme",component:function(){return Promise.all([i.e(0),i.e(1)]).then(i.bind(null,"Yy7+"))}},{path:"/mine",name:" mine",component:function(){return Promise.all([i.e(0),i.e(2)]).then(i.bind(null,"N6Mx"))}},{path:"/star",name:"star",component:function(){return Promise.all([i.e(0),i.e(4)]).then(i.bind(null,"JYMg"))}}]}),f=i("rG/E"),v=i.n(f),g=(i("7QVd"),i("gDRV"),i("SJI6")),y=i.n(g),p=function(t,e){(0,t.commit)("INIT_CANVAS",e)},x=function(t,e){(0,t.commit)("LAYER_ON_CHANGE",e)},b=function(t){return t.canvasData},w=function(t){return t.testData},k={canvasData:new(i("0xDb").a),imgUrlList:[],oldData:localStorage.getItem("canvasData")?JSON.parse(localStorage.getItem("canvasData")):[],collect:["/static/img/theme-demo3.0455a2f.png"]},D=i("bOdI"),S=i.n(D),B=(l={},S()(l,"INIT_CANVAS",function(t,e){t.canvasData.initCanvas(e.width,e.height)}),S()(l,"LAYER_ON_CHANGE",function(t,e){return t.canvasData.findLayer(e)}),S()(l,"addImgUrl",function(t,e){t.imgUrlList.push(e)}),S()(l,"deleteImgUrl",function(t,e){t.imgUrlList.splice(e,1)}),S()(l,"addToCollect",function(t,e){t.collect.find(function(t){return t===e})?alert("已存在"):(t.collect.push(e),console.log(t.collect),alert("收藏成功"))}),l);r.a.use(y.a);var E=new y.a.Store({actions:n,state:k,mutations:B,getters:s});r.a.use(v.a),r.a.config.productionTip=!1,new r.a({el:"#app",beforeCreate:function(){r.a.prototype.$bus=this},router:m,store:E,components:{App:c},template:"<App/>"})},NYMm:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i("Dd8w"),s=i.n(n),a=i("SJI6"),r={computed:s()({},Object(a.mapGetters)(["testData","canvasData"])),methods:s()({},Object(a.mapMutations)({initCanvas:"INIT_CANVAS",handleLayerChange:"LAYER_ON_CHANGE"}),Object(a.mapActions)(["initCanvas","handleLayerChange"]))},o=i("BO1k"),h=i.n(o),c=i("pFYg"),u=i.n(c),d=i("ifoU"),l=i.n(d),m=i("w8iH");function f(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new l.a;if("object"===(void 0===t?"undefined":u()(t))){var i=Array.isArray(t)?[]:{};if(e.get(t))return e.get(t);for(var n in e.set(t,i),t)i[n]=f(t[n],e);return i}return t}var v={t:"top",m:"marginTop",b:"bottom"},g={l:"left",m:"marginLeft",r:"right"},y={name:"drr",props:{x:{type:Number,required:!0,validator:function(t){return"number"==typeof t}},y:{type:Number,required:!0,validator:function(t){return"number"==typeof t}},w:{type:Number,required:!0,validator:function(t){return t>0}},h:{type:Number,required:!0,validator:function(t){return t>0}},angle:{type:Number,default:0,validator:function(t){return"number"==typeof t}},selected:{type:Boolean,default:!1},selectable:{type:Boolean,default:!0},draggable:{type:Boolean,default:!0},resizable:{type:Boolean,default:!0},rotatable:{type:Boolean,default:!0},hasActiveContent:{type:Boolean,default:!1},aspectRatio:{type:Boolean,default:!1},dragHandle:{type:String,default:null},dragCancel:{type:String,default:null},outerBound:{type:Object},innerBound:{type:Object},dragHandler:{type:Function},resizeHandler:{type:Function}},data:function(){return{active:this.selected,contentActive:!1,cx:this.x,cy:this.y,width:this.w,height:this.h,rotation:this.angle,bodyDrag:!1,dragged:!1,resized:!1,rotated:!1}},computed:{sticks:function(){var t=[];return this.resizable&&t.push("tl","tr","br","bl"),this.rotatable&&t.push("ro"),t},classObject:function(){return{active:this.active,inactive:!this.active,selectable:this.selectable,"non-selectable":!this.selectable,dragging:this.bodyDrag,"content-active":this.contentActive}},style:function(){return{left:this.cx-this.width/2+"px",top:this.cy-this.height/2+"px",width:this.width+"px",height:this.height+"px",transform:"rotate("+this.rotation+"deg)"}},drrStick:function(){return function(t){var e={width:"8px",height:"8px"};return"ro"===t?(e.top="-24px",e.marginLeft="-3px"):(e[v[t[0]]]="-4px",e[g[t[1]]]="-4px"),e}}},watch:{active:function(t){t?this.$emit("select"):this.$emit("deselect")},selected:function(t){this.active=t},hasActiveContent:{handler:function(t){t?(this.$on("content-active",this.onContentActive),this.$on("content-inactive",this.onContentInactive)):(this.$off("content-active"),this.$off("content-inactive"),this.contentActive&&this.onContentInactive())},immediate:!0},x:function(){this.stickDrag||this.bodyDrag||(this.cx=this.x)},y:function(){this.stickDrag||this.bodyDrag||(this.cy=this.y)},w:function(){this.stickDrag||this.bodyDrag||(this.currentStick=["m","r"],this.width=this.w)},h:function(){this.stickDrag||this.bodyDrag||(this.currentStick=["b","m"],this.height=this.h)},angle:function(){this.stickDrag||this.bodyDrag||(this.rotation=this.angle)}},created:function(){this.stickDrag=!1,this.bodyDrag=!1,this.stickStartPos={mouseX:0,mouseY:0,x:0,y:0,w:0,h:0},this.currentStick=[]},mounted:function(){if(this.parentElement=this.$el.parentNode,document.documentElement.addEventListener("mousemove",this.move),document.documentElement.addEventListener("mouseup",this.up),document.documentElement.addEventListener("mouseleave",this.up),document.documentElement.addEventListener("mousedown",this.deselect),document.documentElement.addEventListener("touchmove",this.move,!0),document.documentElement.addEventListener("touchend touchcancel",this.up,!0),document.documentElement.addEventListener("touchstart",this.up,!0),this.dragHandle){var t=Array.prototype.slice.call(this.$el.querySelectorAll(this.dragHandle));for(var e in t)t[e].setAttribute("data-drag-handle",this._uid)}if(this.dragCancel){var i=Array.prototype.slice.call(this.$el.querySelectorAll(this.dragCancel));for(var n in i)i[n].setAttribute("data-drag-cancel",this._uid)}},beforeDestroy:function(){document.documentElement.removeEventListener("mousemove",this.move),document.documentElement.removeEventListener("mouseup",this.up),document.documentElement.removeEventListener("mouseleave",this.up),document.documentElement.removeEventListener("mousedown",this.deselect),document.documentElement.removeEventListener("touchmove",this.move,!0),document.documentElement.removeEventListener("touchend touchcancel",this.up,!0),document.documentElement.removeEventListener("touchstart",this.up,!0)},methods:{getRect:function(){return{x:this.cx,y:this.cy,w:this.width,h:this.height,angle:this.rotation}},setRect:function(t){this.cx=t.x,this.cy=t.y,this.width=t.w,this.height=t.h,this.angle=t.angle},dblclick:function(t){this.selectable&&this.$emit("content-active")},onContentActive:function(){this.contentActive=!0,this.active=!1;var t=!0,e=!1,i=void 0;try{for(var n,s=h()(this.$children);!(t=(n=s.next()).done);t=!0){n.value.$emit("active")}}catch(t){e=!0,i=t}finally{try{!t&&s.return&&s.return()}finally{if(e)throw i}}},onContentInactive:function(){this.contentActive=!1,this.active=!0;var t=!0,e=!1,i=void 0;try{for(var n,s=h()(this.$children);!(t=(n=s.next()).done);t=!0){n.value.$emit("inactive")}}catch(t){e=!0,i=t}finally{try{!t&&s.return&&s.return()}finally{if(e)throw i}}},deselect:function(){this.$emit("deselect"),this.active=!1},move:function(t){(this.stickDrag||this.bodyDrag)&&(t.stopPropagation(),this.stickDrag&&this.stickMove(t),this.bodyDrag&&this.bodyMove(t))},up:function(t){this.stickDrag&&this.stickUp(t),this.bodyDrag&&this.bodyUp(t)},bodyMouseDown:function(t){if(!this.contentActive&&this.selectable){t.preventDefault(),t.stopPropagation();var e=t.target||t.srcElement;this.active=!0,t.button&&0!==t.button||(this.$emit("clicked",t),this.draggable&&this.active&&(this.dragHandle&&e.getAttribute("data-drag-handle")!==this._uid.toString()||this.dragCancel&&e.getAttribute("data-drag-cancel")===this._uid.toString()||(this.bodyDrag=!0,this.dragged=!1,this.dragStartEmitted=!1,this.startRect=f(this.getRect()),this.stickStartPos.mouseX=t.pageX||t.touches[0].pageX,this.stickStartPos.mouseY=t.pageY||t.touches[0].pageY,this.stickStartPos.cx=this.cx,this.stickStartPos.cy=this.cy)))}},bodyMove:function(t){var e=this.stickStartPos,i=t.pageX||t.touches[0].pageX,n=t.pageY||t.touches[0].pageY,s={x:i-e.mouseX,y:n-e.mouseY},a=e.cx+s.x,r=e.cy+s.y,o=a-this.width/2,h=r-this.height/2,c=a+this.width/2,u=r+this.height/2;if(this.outerBound&&0===this.rotation){var d=this.outerBound.x-this.outerBound.w/2,l=this.outerBound.y-this.outerBound.h/2,m=this.outerBound.x+this.outerBound.w/2,f=this.outerBound.y+this.outerBound.h/2;o<d&&(s.x-=o-d),c>m&&(s.x-=c-m),h<l&&(s.y-=h-l),u>f&&(s.y-=u-f)}if(this.innerBound&&0===this.rotation){var v=this.innerBound.x-this.innerBound.w/2,g=this.innerBound.y-this.innerBound.h/2,y=this.innerBound.x+this.innerBound.w/2,p=this.innerBound.y+this.innerBound.h/2;o>v&&(s.x-=o-v),c<y&&(s.x-=c-y),h>g&&(s.y-=h-g),u<p&&(s.y-=u-p)}this.cx=e.cx+s.x,this.cy=e.cy+s.y,this.dragHandler&&this.setRect(this.dragHandler(this.getRect())),this.dragStartEmitted||(this.$emit("dragstart",this.startRect),this.dragStartEmitted=!0),this.dragged=!0,this.$emit("drag",this.getRect())},bodyUp:function(){this.bodyDrag=!1,this.dragged&&(this.$emit("dragstop",this.getRect(),this.startRect),this.$emit("change",this.getRect())),this.stickStartPos={mouseX:0,mouseY:0,x:0,y:0,w:0,h:0}},stickDown:function(t,e){this.resizable&&this.active&&(this.resizeStartEmitted=!1,this.rotateStartEmitted=!1,this.startRect=f(this.getRect()),this.stickDrag=!0,this.resized=!1,this.rotated=!1,this.stickStartPos.mouseX=e.pageX||e.touches[0].pageX,this.stickStartPos.mouseY=e.pageY||e.touches[0].pageY,this.stickStartPos.cx=this.cx,this.stickStartPos.cy=this.cy,this.stickStartPos.width=this.width,this.stickStartPos.height=this.height,this.stickStartPos.rotation=this.rotation,this.currentStick=t)},stickMove:function(t){var e=this.stickStartPos,i=new m.a((t.pageX||t.touches[0].pageX)-e.mouseX,(t.pageY||t.touches[0].pageY)-e.mouseY);if("ro"===this.currentStick){var n=new m.a(0,-this.height/2-20),s=m.a.rad(e.rotation),a=(n=n.rotate(s)).add(i);this.rotateStartEmitted||(this.$emit("rotatestart",this.startRect),this.rotateStartEmitted=!0),this.rotation=m.a.deg(a.angle())+90,this.rotated=!0,this.$emit("rotate",this.getRect())}else{var r="r"===this.currentStick[1]?1:-1,o="b"===this.currentStick[0]?1:-1,h=m.a.rad(e.rotation),c=void 0;if(this.aspectRatio){var u=new m.a(r*e.width/2,o*e.height/2);c=(u=u.rotate(h).unit()).mul(u.mul(i))}else c=i;var d=c.rotate(-h),l=e.cx+c.x/2,f=e.cy+c.y/2,v=e.width+r*d.x,g=e.height+o*d.y,y=l-v/2,p=f-g/2,x=l+v/2,b=f+g/2;if(this.outerBound&&0===this.rotation){var w=this.outerBound.x-this.outerBound.w/2,k=this.outerBound.y-this.outerBound.h/2,D=this.outerBound.x+this.outerBound.w/2,S=this.outerBound.y+this.outerBound.h/2,B=0,E=0;y<w&&(B=w-y),x>D&&(B=D-x),p<k&&(E=k-p),b>S&&(E=S-b),0===B&&0===E||(this.aspectRatio?B/c.x<E/c.y?(c.y+=B*c.y/c.x,c.x+=B):(c.x+=E*c.x/c.y,c.y+=E):(c.x+=B,c.y+=E))}if(this.innerBound&&0===this.rotation){var R=this.innerBound.x-this.innerBound.w/2,$=this.innerBound.y-this.innerBound.h/2,C=this.innerBound.x+this.innerBound.w/2,A=this.innerBound.y+this.innerBound.h/2,L=0,_=0;y>R&&(L=R-y),x<C&&(L=C-x),p>$&&(_=$-p),b<A&&(_=A-b),0===L&&0===_||(this.aspectRatio?L/c.x<_/c.y?(c.y+=L*c.y/c.x,c.x+=L):(c.x+=_*c.x/c.y,c.y+=_):(c.x+=L,c.y+=_))}this.cx=e.cx+c.x/2,this.cy=e.cy+c.y/2,d=c.rotate(-h),this.width=e.width+r*d.x,this.height=e.height+o*d.y,this.resizeHandler&&this.setRect(this.resizeHandler(this.getRect())),this.resizeStartEmitted||(this.$emit("resizestart",this.startRect),this.resizeStartEmitted=!0),this.resized=!0,this.$emit("resize",this.getRect())}},stickUp:function(){this.stickDrag=!1,this.stickStartPos={mouseX:0,mouseY:0,x:0,y:0,w:0,h:0},this.resized&&(this.$emit("resizestop",this.getRect(),this.startRect),this.$emit("change",this.getRect())),this.rotated&&(this.$emit("rotatestop",this.getRect(),this.startRect),this.$emit("change",this.getRect()))}}},p={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"drr",class:t.classObject,style:t.style,on:{dblclick:function(e){return t.dblclick(e)},mousedown:function(e){return t.bodyMouseDown(e)}}},[t._t("default"),t._v(" "),t._l(t.sticks,function(e){return i("div",{key:e,staticClass:"drr-stick",class:["drr-stick-"+e,t.resizable?"":"not-resizable"],style:t.drrStick(e),on:{mousedown:function(i){return i.stopPropagation(),i.preventDefault(),t.stickDown(e,i)}}})}),t._v(" "),t.rotatable?i("div",{staticClass:"ro-stick-handle"}):t._e()],2)},staticRenderFns:[]};var x=i("VU/8")(y,p,!1,function(t){i("aDbQ")},"data-v-512e0b88",null).exports,b={data:function(){return{editable:!1}},props:{layerData:i("0xDb").b},mounted:function(){this.$on("active",this.onActive)},methods:{onActive:function(){this.editable=!0,this.$nextTick(function(){this.$refs.input.focus()})},onBlur:function(){this.editable=!1,this.$parent.$emit("content-inactive")}}},w={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.editable&&"text"===t.layerData.type?i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.layerData.content,expression:"layerData.content"}],ref:"input",staticClass:"input",attrs:{placeholder:"请输入内容"},domProps:{value:t.layerData.content},on:{blur:t.onBlur,input:function(e){e.target.composing||t.$set(t.layerData,"content",e.target.value)}}}):t.editable||"text"!==t.layerData.type?i("div",{staticClass:"layer"},[i("img",{staticStyle:{width:"100%",height:"100%"},attrs:{src:t.layerData.content}})]):i("div",{staticClass:"text",on:{active:t.onActive}},[t._v("\n  "+t._s(""===t.layerData.content?"请输入内容":t.layerData.content)+"\n")])},staticRenderFns:[]};var k=i("VU/8")(b,w,!1,function(t){i("l8pa")},null,null).exports,D=i("ULGn"),S=i.n(D),B={name:"canvasBox",props:{canvasStyle:{type:Object,default:function(){}}},components:{DragableBox:x,LayerBox:k},mounted:function(){this.$store.state.canvasData.initCanvasSize(this.$refs.canvasRef.offsetWidth,this.$refs.canvasRef.offsetHeight),this.$on("saveImg",this.saveImg)},methods:{deleteLayer:function(t){this.canvasData.layers.splice(t,1)},onChange:function(t){return function(e){return t.setRect(e)}},saveImg:function(){S()(this.$refs.canvasRef,{allowTaint:!0}).then(function(t){var e=t.toDataURL("png"),i=document.createElementNS("http://www.w3.org/1999/xhtml","a");i.href=e,i.download="页面.png";var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!1,window),i.dispatchEvent(n)})}},mixins:[r],computed:{layers:function(){return this.$store.state.canvasData.layers}}},E={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"canvasRef",staticClass:"canvasBox",style:t.canvasStyle},t._l(t.layers,function(e,n){return i("DragableBox",{key:n,staticClass:"dragableBox",attrs:{w:e.width,h:e.height,x:e.x,y:e.y,angle:e.rotation,hasActiveContent:"text"===e.type,dragHandler:t.onChange(e),resizeHandler:t.onChange(e)}},[i("div",{staticClass:"delete",on:{click:function(e){return t.deleteLayer(n)}}},[t._v("×")]),t._v(" "),i("LayerBox",{staticStyle:{width:"100%",height:"100%"},attrs:{layerData:e}})],1)}),1)},staticRenderFns:[]};var R=i("VU/8")(B,E,!1,function(t){i("BrM/")},"data-v-50a08b6b",null);e.default=R.exports},SJI6:function(t,e){t.exports=Vuex},ULGn:function(t,e){t.exports=html2canvas},Zmby:function(t,e){},aDbQ:function(t,e){},gDRV:function(t,e){},l8pa:function(t,e){},lRwf:function(t,e){t.exports=Vue},pRNm:function(t,e){t.exports=VueRouter},"rG/E":function(t,e){t.exports=iview}},["NHnr"]);
//# sourceMappingURL=app.d7e1a10cf4c65135c1cf.js.map